{% extends 'base.html' %}

{% block title %}{{ employee.full_name }} - Employee Details{% endblock %}

{% block page_title %}Employee Profile{% endblock %}

{% block extra_css %}
<style>
    .profile-header-card {
        background: linear-gradient(135deg, #00376e 0%, #002855 100%);
        color: white;
        border-radius: 16px;
        padding: 40px;
        margin-bottom: 24px;
        text-align: center;
    }

    .profile-avatar-large {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: #00C9FF;
        color: #002855;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        font-weight: 800;
        margin: 0 auto 24px;
        box-shadow: 0 12px 32px rgba(0, 201, 255, 0.4);
    }

    .profile-name {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #fff;
    }

    .profile-designation {
        font-size: 16px;
        opacity: 0.9;
        margin-bottom: 20px;
    }

    .profile-badges {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 24px;
    }

    .profile-badge {
        padding: 8px 16px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.2);
        font-size: 13px;
        font-weight: 600;
    }

    .profile-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<!-- Profile Header -->
<div class="profile-header-card">
    <div class="profile-avatar-large">
        {{ employee.full_name|slice:":2"|upper }}
    </div>
    <h1 class="profile-name">{{ employee.full_name }}</h1>
    <p class="profile-designation">{{ employee.designation.name }}</p>

    <div class="profile-badges">
        <span class="profile-badge">
            <i class="bi bi-hash"></i> {{ employee.employee_code }}
        </span>
        <span class="profile-badge">
            <i class="bi bi-building"></i> {{ employee.department.name }}
        </span>
        <span
            class="profile-badge {% if employee.employment_status == 'active' %}bg-success{% else %}bg-danger{% endif %}">
            <i
                class="bi bi-{% if employee.employment_status == 'active' %}check-circle{% else %}x-circle{% endif %}"></i>
            {{ employee.get_employment_status_display }}
        </span>
    </div>

    <div class="profile-actions">
        {% if request.user.is_superuser or request.user.is_staff %}
        <a href="{% url 'employees:employee_edit' employee.pk %}" class="btn btn-light">
            <i class="bi bi-pencil me-2"></i>Edit Profile
        </a>
        {% endif %}
        <a href="{% url 'employees:employee_list' %}" class="btn btn-outline-light">
            <i class="bi bi-arrow-left me-2"></i>Back to List
        </a>
    </div>
</div>

<div class="row">
    <!-- Left Column -->
    <div class="col-lg-6">
        <!-- Contact Information -->
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-telephone text-primary"></i>
                Contact Information
            </h5>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Mobile Number</div>
                    <div class="detail-value">{{ employee.mobile_number }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Official Email</div>
                    <div class="detail-value">{{ employee.official_email }}</div>
                </div>
            </div>
            {% if employee.personal_email %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Personal Email</div>
                    <div class="detail-value">{{ employee.personal_email }}</div>
                </div>
            </div>
            {% endif %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Local Address</div>
                    <div class="detail-value">{{ employee.local_address|linebreaksbr }}</div>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Permanent Address</div>
                    <div class="detail-value">{{ employee.permanent_address|linebreaksbr }}</div>
                </div>
            </div>
        </div>

        <!-- Emergency Contact -->
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-exclamation-triangle text-danger"></i>
                Emergency Contact
            </h5>
            {% if employee.emergency_contact %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Name</div>
                    <div class="detail-value">{{ employee.emergency_contact.name }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Relationship</div>
                    <div class="detail-value">{{ employee.emergency_contact.relationship }}</div>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Mobile</div>
                    <div class="detail-value">{{ employee.emergency_contact.mobile_number }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value">{{ employee.emergency_contact.email }}</div>
                </div>
            </div>
            {% else %}
            <p class="text-muted">No emergency contact information available.</p>
            {% endif %}
        </div>

        <!-- Personal Information -->
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-person text-info"></i>
                Personal Information
            </h5>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Date of Birth</div>
                    <div class="detail-value">{{ employee.date_of_birth|date:"M d, Y" }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Age</div>
                    <div class="detail-value">{{ employee.age }} years</div>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Gender</div>
                    <div class="detail-value">{{ employee.get_gender_display }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Blood Group</div>
                    <div class="detail-value">{{ employee.blood_group|default:"—" }}</div>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Marital Status</div>
                    <div class="detail-value">{{ employee.get_marital_status_display }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Nationality</div>
                    <div class="detail-value">{{ employee.nationality|default:"—" }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div class="col-lg-6">
        <!-- Employment Details -->
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-briefcase text-success"></i>
                Employment Details
            </h5>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Joining Date</div>
                    <div class="detail-value">{{ employee.joining_date|date:"M d, Y" }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Total Experience</div>
                    <div class="detail-value">{{ employee.total_experience_display }}</div>
                </div>
            </div>
            {% if employee.relieving_date %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Relieving Date</div>
                    <div class="detail-value">{{ employee.relieving_date|date:"M d, Y" }}</div>
                </div>
            </div>
            {% endif %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Probation Status</div>
                    <div class="detail-value">
                        <span
                            class="status-badge {% if employee.probation_status == 'completed' %}success{% else %}warning{% endif %}">
                            {{ employee.probation_status|title }}
                        </span>
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Employment Type</div>
                    <div class="detail-value">{{ employee.get_employment_type_display }}</div>
                </div>
            </div>
        </div>

        <!-- Bank Details -->
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-bank text-warning"></i>
                Bank Details
            </h5>
            {% if employee.bank_details %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Bank Name</div>
                    <div class="detail-value">{{ employee.bank_details.bank_name }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Account Number</div>
                    <div class="detail-value">{{ employee.bank_details.account_number }}</div>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">IFSC Code</div>
                    <div class="detail-value">{{ employee.bank_details.ifsc_code }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Branch</div>
                    <div class="detail-value">{{ employee.bank_details.branch_name }}</div>
                </div>
            </div>
            {% else %}
            <p class="text-muted">No bank details available.</p>
            {% endif %}
        </div>

        <!-- Documents -->
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-file-earmark-text text-primary"></i>
                Documents
            </h5>
            {% if employee.documents %}
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">PAN Number</div>
                    <div class="detail-value">{{ employee.documents.pan_number|default:"—" }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Aadhar Number</div>
                    <div class="detail-value">{{ employee.documents.aadhar_number|default:"—" }}</div>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Passport Number</div>
                    <div class="detail-value">{{ employee.documents.passport_number|default:"—" }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">UAN Number</div>
                    <div class="detail-value">{{ employee.documents.uan_number|default:"—" }}</div>
                </div>
            </div>
            {% else %}
            <p class="text-muted">No documents available.</p>
            {% endif %}
        </div>

        <!-- Login Credentials -->
        {% if request.user.is_superuser or request.user.is_staff %}
        <div class="detail-section">
            <h5 class="detail-section-title">
                <i class="bi bi-key text-danger"></i>
                Login Credentials
            </h5>
            <div class="detail-row">
                <div class="detail-item">
                    <div class="detail-label">Username</div>
                    <div class="detail-value">{{ employee.user.username }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Password</div>
                    <div class="detail-value">
                        <span id="password-display">******{{ employee.plain_password|slice:"-3:" }}</span>
                        <button class="btn btn-sm btn-outline-primary ms-2"
                            onclick="copyPassword('{{ employee.plain_password }}')">
                            <i class="bi bi-clipboard"></i> Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function copyPassword(password) {
        navigator.clipboard.writeText(password).then(function () {
            alert('Password copied to clipboard!');
        }, function (err) {
            console.error('Could not copy password: ', err);
        });
    }
</script>
{% endblock %}