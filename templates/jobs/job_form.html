{% extends 'base.html' %}

{% block title %}{% if form.instance.pk %}Edit Job{% else %}Create Job{% endif %} - HRMS Portal{% endblock %}

{% block page_title %}{% if form.instance.pk %}Edit Job Description{% else %}Create Job Description{% endif %}{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">
            <i class="bi bi-briefcase text-primary"></i>
            {% if form.instance.pk %}Edit Job Description{% else %}Create Job Description{% endif %}
        </h1>
        <p class="page-subtitle">Define job requirements and responsibilities</p>
    </div>
    <a href="{% url 'employees:job_list' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Back to Jobs
    </a>
</div>

<form method="post" id="jobForm" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Basic Information -->
    <div class="modern-card mb-4">
        <div class="modern-card-header">
            <h5 class="modern-card-title">
                <i class="bi bi-info-circle"></i>
                Basic Information
            </h5>
        </div>
        <div class="modern-card-body">
            <div class="row g-3">
                <div class="col-md-8">
                    <div class="modern-form-group">
                        <label class="modern-form-label required">{{ form.title.label }}</label>
                        {{ form.title }}
                        {% if form.title.errors %}
                        <div class="text-danger small mt-1">{{ form.title.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="modern-form-group">
                        <label class="modern-form-label required">{{ form.department.label }}</label>
                        {{ form.department }}
                        {% if form.department.errors %}
                        <div class="text-danger small mt-1">{{ form.department.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.employment_type.label }}</label>
                        {{ form.employment_type }}
                        {% if form.employment_type.errors %}
                        <div class="text-danger small mt-1">{{ form.employment_type.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.experience_level.label }}</label>
                        {{ form.experience_level }}
                        {% if form.experience_level.errors %}
                        <div class="text-danger small mt-1">{{ form.experience_level.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.status.label }}</label>
                        {{ form.status }}
                        {% if form.status.errors %}
                        <div class="text-danger small mt-1">{{ form.status.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.location.label }}</label>
                        {{ form.location }}
                        {% if form.location.errors %}
                        <div class="text-danger small mt-1">{{ form.location.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.number_of_vacancies.label }}</label>
                        {{ form.number_of_vacancies }}
                        {% if form.number_of_vacancies.errors %}
                        <div class="text-danger small mt-1">{{ form.number_of_vacancies.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.application_deadline.label }}</label>
                        {{ form.application_deadline }}
                        {% if form.application_deadline.errors %}
                        <div class="text-danger small mt-1">{{ form.application_deadline.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Details -->
    <div class="modern-card mb-4">
        <div class="modern-card-header">
            <h5 class="modern-card-title">
                <i class="bi bi-file-text"></i>
                Job Details
            </h5>
        </div>
        <div class="modern-card-body">
            <div class="row g-3">
                <div class="col-12">
                    <div class="modern-form-group">
                        <label class="modern-form-label required">{{ form.job_description.label }}</label>
                        {{ form.job_description }}
                        {% if form.job_description.errors %}
                        <div class="text-danger small mt-1">{{ form.job_description.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-12">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.requirements.label }}</label>
                        {{ form.requirements }}
                        {% if form.requirements.errors %}
                        <div class="text-danger small mt-1">{{ form.requirements.errors.0 }}</div>
                        {% endif %}
                        <small class="form-help-text">List each requirement on a new line</small>
                    </div>
                </div>

                <div class="col-12">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.responsibilities.label }}</label>
                        {{ form.responsibilities }}
                        {% if form.responsibilities.errors %}
                        <div class="text-danger small mt-1">{{ form.responsibilities.errors.0 }}</div>
                        {% endif %}
                        <small class="form-help-text">List each responsibility on a new line</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Compensation -->
    <div class="modern-card mb-4">
        <div class="modern-card-header">
            <h5 class="modern-card-title">
                <i class="bi bi-currency-dollar"></i>
                Compensation
            </h5>
        </div>
        <div class="modern-card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.min_salary.label }}</label>
                        {{ form.min_salary }}
                        {% if form.min_salary.errors %}
                        <div class="text-danger small mt-1">{{ form.min_salary.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="modern-form-group">
                        <label class="modern-form-label">{{ form.max_salary.label }}</label>
                        {{ form.max_salary }}
                        {% if form.max_salary.errors %}
                        <div class="text-danger small mt-1">{{ form.max_salary.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Actions -->
    <div class="d-flex justify-content-end gap-2">
        <a href="{% url 'employees:job_list' %}" class="btn btn-outline-secondary">
            <i class="bi bi-x-circle me-2"></i>Cancel
        </a>
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-circle me-2"></i>
            {% if form.instance.pk %}Update Job{% else %}Create Job{% endif %}
        </button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const formInputs = document.querySelectorAll('#jobForm input, #jobForm select, #jobForm textarea');
        formInputs.forEach(input => {
            input.classList.add('modern-form-control');
            if (input.tagName === 'SELECT') {
                input.classList.add('modern-form-select');
            }
            if (input.tagName === 'TEXTAREA') {
                input.classList.add('modern-form-textarea');
            }
        });

        // Form validation and submission
        const jobForm = document.getElementById('jobForm');
        if (jobForm) {
            jobForm.addEventListener('submit', function(e) {
                // Basic validation
                const title = document.querySelector('[name="title"]');
                const jobDescription = document.querySelector('[name="job_description"]');
                
                if (!title || !title.value.trim()) {
                    e.preventDefault();
                    alert('Please enter a job title');
                    title.focus();
                    return false;
                }
                
                if (!jobDescription || !jobDescription.value.trim()) {
                    e.preventDefault();
                    alert('Please enter a job description');
                    jobDescription.focus();
                    return false;
                }
                
                // Show loading state
                const submitBtn = document.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Saving...';
                }
                
                return true;
            });
        }
    });
</script>
{% endblock %}